on:
  pull_request:
  # push:
    # branches:
      # - main

permissions:
  contents: write
  pull-requests: write

name: Release and deploy
jobs:
  release-please-config:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Parse release-please-config.json to outputs
        id: read-release-please-config
        run: |
          # capture the whole config as steps.read-release-please-config.outputs.releasePleaseConfig
          echo 'releasePleaseConfig="`jq '\''.'\'' release-please-config.json`"' >> "$GITHUB_OUTPUT" 
          # capture the packages as an array steps.read-release-please-config.outputs.releasePleaseConfigPackages
          echo 'releasePleaseConfigPackages="`jq '\''.packages | keys[]'\'' release-please-config.json | jq -n '\''[inputs]'\''`"' >> "$GITHUB_OUTPUT" 
  outputs:
    releasePleaseConfig: ${{ steps.read-release-please-config.outputs.releasePleaseConfig }} 
    releasePleaseConfigPackages: ${{ steps.read-release-please-config.outputs.releasePleaseConfigPackages }} 

  build-packages:
    runs-on: ubuntu-latest
    needs: read-release-please-config
    steps:
      - name: what
        run: |
          echo ${{ needs.release-please-config.outputs.releasePleaseConfig }} 
          echo ${{ needs.release-please-config.outputs.releasePleaseConfigPackages }} 


  # release-please:
    # runs-on: ubuntu-latest
    # steps:
      # - uses: google-github-actions/release-please-action@v3
        # id: release
        # with:
          # command: manifest
          # token: ${{secrets.GITHUB_TOKEN}}
          # default-branch: main
