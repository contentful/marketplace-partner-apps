on:
  pull_request:
  # push:
    # branches:
      # - main

permissions:
  contents: write
  pull-requests: write

name: Release and deploy
jobs:
  release-please-config:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Parse release-please-config.json to outputs
        id: read-release-please-config
        run: |
          # read and parse config data from file
          releasePleaseConfig=`jq '.' release-please-config.json`
          releasePleaseConfigPackages=`jq '.packages | keys[]' release-please-config.json | jq -n '[inputs]'`

          # send parsed data to job outputs
          echo releasePleaseConfig=$releasePleaseConfig >> "$GITHUB_OUTPUT" 
          echo releasePleaseConfigPackages=$releasePleaseConfigPackages >> "$GITHUB_OUTPUT" 
    outputs:
      releasePleaseConfig: ${{ steps.read-release-please-config.outputs.releasePleaseConfig }} 
      releasePleaseConfigPackages: ${{ steps.read-release-please-config.outputs.releasePleaseConfigPackages }} 

  build-packages:
    runs-on: ubuntu-latest
    needs: release-please-config
    strategy:
      matrix:
        package: ${{ fromJson(needs.release-please-config.outputs.releasePleaseConfigPackages) }}
    steps:
      - name: what
        run: |
          echo "package is ${{ matrix.package }}"


  # release-please:
    # runs-on: ubuntu-latest
    # steps:
      # - uses: google-github-actions/release-please-action@v3
        # id: release
        # with:
          # command: manifest
          # token: ${{secrets.GITHUB_TOKEN}}
          # default-branch: main
